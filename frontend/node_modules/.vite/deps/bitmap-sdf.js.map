{
  "version": 3,
  "sources": ["../../bitmap-sdf/index.js"],
  "sourcesContent": ["'use strict'\r\n\r\nmodule.exports = calcSDF\r\n\r\nvar INF = 1e20\r\n\r\nfunction calcSDF(src, options) {\r\n    if (!options) options = {}\r\n\r\n    var cutoff = options.cutoff == null ? 0.25 : options.cutoff\r\n    var radius = options.radius == null ? 8 : options.radius\r\n    var channel = options.channel || 0\r\n    var w, h, size, data, intData, stride, ctx, canvas, imgData, i, l\r\n\r\n    // handle image container\r\n    if (ArrayBuffer.isView(src) || Array.isArray(src)) {\r\n        if (!options.width || !options.height) throw Error('For raw data width and height should be provided by options')\r\n        w = options.width, h = options.height\r\n        data = src\r\n\r\n        if (!options.stride) stride = Math.floor(src.length / w / h)\r\n        else stride = options.stride\r\n    }\r\n    else {\r\n        if (window.HTMLCanvasElement && src instanceof window.HTMLCanvasElement) {\r\n            canvas = src\r\n            ctx = canvas.getContext('2d')\r\n            w = canvas.width, h = canvas.height\r\n            imgData = ctx.getImageData(0, 0, w, h)\r\n            data = imgData.data\r\n            stride = 4\r\n        }\r\n        else if (window.CanvasRenderingContext2D && src instanceof window.CanvasRenderingContext2D) {\r\n            canvas = src.canvas\r\n            ctx = src\r\n            w = canvas.width, h = canvas.height\r\n            imgData = ctx.getImageData(0, 0, w, h)\r\n            data = imgData.data\r\n            stride = 4\r\n        }\r\n        else if (window.ImageData && src instanceof window.ImageData) {\r\n            imgData = src\r\n            w = src.width, h = src.height\r\n            data = imgData.data\r\n            stride = 4\r\n        }\r\n    }\r\n\r\n    size = Math.max(w, h)\r\n\r\n    //convert int data to floats\r\n    if ((window.Uint8ClampedArray && data instanceof window.Uint8ClampedArray) || (window.Uint8Array && data instanceof window.Uint8Array)) {\r\n        intData = data\r\n        data = Array(w*h)\r\n\r\n        for (i = 0, l = Math.floor(intData.length / stride); i < l; i++) {\r\n            data[i] = intData[i*stride + channel] / 255\r\n        }\r\n    }\r\n    else {\r\n        if (stride !== 1) throw Error('Raw data can have only 1 value per pixel')\r\n    }\r\n\r\n    // temporary arrays for the distance transform\r\n    var gridOuter = Array(w * h)\r\n    var gridInner = Array(w * h)\r\n    var f = Array(size)\r\n    var d = Array(size)\r\n    var z = Array(size + 1)\r\n    var v = Array(size)\r\n\r\n    for (i = 0, l = w * h; i < l; i++) {\r\n        var a = data[i]\r\n        gridOuter[i] = a === 1 ? 0 : a === 0 ? INF : Math.pow(Math.max(0, 0.5 - a), 2)\r\n        gridInner[i] = a === 1 ? INF : a === 0 ? 0 : Math.pow(Math.max(0, a - 0.5), 2)\r\n    }\r\n\r\n    edt(gridOuter, w, h, f, d, v, z)\r\n    edt(gridInner, w, h, f, d, v, z)\r\n\r\n    var dist = window.Float32Array ? new Float32Array(w * h) : new Array(w * h)\r\n\r\n    for (i = 0, l = w*h; i < l; i++) {\r\n        dist[i] = Math.min(Math.max(1 - ( (gridOuter[i] - gridInner[i]) / radius + cutoff), 0), 1)\r\n    }\r\n\r\n    return dist\r\n}\r\n\r\n// 2D Euclidean distance transform by Felzenszwalb & Huttenlocher https://cs.brown.edu/~pff/dt/\r\nfunction edt(data, width, height, f, d, v, z) {\r\n    for (var x = 0; x < width; x++) {\r\n        for (var y = 0; y < height; y++) {\r\n            f[y] = data[y * width + x]\r\n        }\r\n        edt1d(f, d, v, z, height)\r\n        for (y = 0; y < height; y++) {\r\n            data[y * width + x] = d[y]\r\n        }\r\n    }\r\n    for (y = 0; y < height; y++) {\r\n        for (x = 0; x < width; x++) {\r\n            f[x] = data[y * width + x]\r\n        }\r\n        edt1d(f, d, v, z, width)\r\n        for (x = 0; x < width; x++) {\r\n            data[y * width + x] = Math.sqrt(d[x])\r\n        }\r\n    }\r\n}\r\n\r\n// 1D squared distance transform\r\nfunction edt1d(f, d, v, z, n) {\r\n    v[0] = 0;\r\n    z[0] = -INF\r\n    z[1] = +INF\r\n\r\n    for (var q = 1, k = 0; q < n; q++) {\r\n        var s = ((f[q] + q * q) - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k])\r\n        while (s <= z[k]) {\r\n            k--\r\n            s = ((f[q] + q * q) - (f[v[k]] + v[k] * v[k])) / (2 * q - 2 * v[k])\r\n        }\r\n        k++\r\n        v[k] = q\r\n        z[k] = s\r\n        z[k + 1] = +INF\r\n    }\r\n\r\n    for (q = 0, k = 0; q < n; q++) {\r\n        while (z[k + 1] < q) k++\r\n        d[q] = (q - v[k]) * (q - v[k]) + f[v[k]]\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
